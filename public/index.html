<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Walmart ‚ú≥ Groceries ‚Äî VoxTalk‚Ñ¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="navbar">
    <h1 class="brand">
      <span class="brand-main">Walmart</span><span class="brand-icon">‚ú≥</span>
      <span class="brand-sub">Groceries</span>
    </h1>
    <p class="tagline">Your neighborhood grocery store</p>
  </header>

  <main class="container">
    <!-- Buttons -->
    <div class="portal-row">
      <button id="cartBtn" class="portal">üõí Cart</button>
      <button id="infoBtn" class="portal">‚ÑπÔ∏è Info</button>
      <button id="checkoutBtn" class="portal">üí≥ Checkout</button>
    </div>

    <!-- Upload -->
    <div class="upload-section">
      <button id="uploadBtn" class="upload-btn">Upload Your Grocery List</button>
      <input type="file" id="fileUpload" accept=".txt,.jpg,.png,.pdf" hidden>
    </div>

    <!-- Chat -->
    <div class="chat-section">
      <h2>Let Our AI Grocery Associate Help You</h2>

      <div class="voice-wrap">
        <button id="pttBtn" class="halo-button"></button>
        <div id="voiceStatus" class="hint">Click to Talk</div>
        <button id="pauseBtn" class="pause-btn">Pause</button>
      </div>
      <audio id="remote" autoplay playsinline></audio>

      <div id="answer" class="transcript"></div>

      <div class="classic-chat">
        <input id="userInput" placeholder="Type here to chat‚Ä¶" />
        <button id="sendBtn">Send</button>
      </div>

      <div class="controls">
        <button id="showConversation" class="left">Show Conversation</button>
        <button id="contactHuman" class="right">Contact a Human</button>
      </div>
    </div>

    <!-- Panels -->
    <section id="cartPanel" class="panel hidden"><h3>Cart</h3></section>
    <section id="infoPanel" class="panel hidden"><h3>Information</h3><p>Standard VoxTalk layout for brand consistency.</p></section>
    <section id="checkoutPanel" class="panel hidden"><h3>Checkout</h3><p>Checkout flow coming soon.</p></section>

    <!-- Contact panel -->
    <section id="contactPanel" class="contact-panel hidden">
      <div class="contact-header">
        <span>Need a human?</span>
        <button id="contactClose" class="contact-close">√ó</button>
      </div>
      <div class="contact-body">
        <p>Email: <a href="mailto:support@example.com">support@example.com</a></p>
        <p>Phone: <a href="tel:+18885551234">+1 (888) 555-1234</a></p>
      </div>
    </section>
  </main>

  <footer class="footer">
    ¬© 2025 VoxTalk ‚Ä¢ A comfortable AI experience ‚Äî powered by VoxTalk‚Ñ¢
  </footer>

  <script>
    /* Upload */
    uploadBtn.onclick = () => fileUpload.click();

    /* Panels */
    function showPanel(id){
      document.querySelectorAll(".panel").forEach(p=>p.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }
    document.getElementById("cartBtn").onclick=()=>showPanel("cartPanel");
    document.getElementById("infoBtn").onclick=()=>showPanel("infoPanel");
    document.getElementById("checkoutBtn").onclick=()=>showPanel("checkoutPanel");

    /* Chat */
    const inputEl=document.getElementById("userInput");
    const sendBtn=document.getElementById("sendBtn");
    const answerEl=document.getElementById("answer");
    function append(role,text){
      const p=document.createElement("p");
      p.className=role;p.textContent=text;
      answerEl.appendChild(p);answerEl.scrollTop=answerEl.scrollHeight;
    }
    async function sendChat(){
      const text=inputEl.value.trim();if(!text)return;
      append("user",text);inputEl.value="";
      try{
        const r=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text})});
        const d=await r.json();append("assistant",d.reply||"");
      }catch{append("error","Chat unavailable.");}
    }
    sendBtn.onclick=sendChat;
    inputEl.onkeydown=e=>{if(e.key==="Enter")sendChat();};

    /* Realtime voice */
    const pttBtn=document.getElementById("pttBtn");
    const remote=document.getElementById("remote");
    const voiceStatus=document.getElementById("voiceStatus");
    let pc,micStream;
    async function startSession(){
      voiceStatus.textContent="Connecting‚Ä¶";
      try{
        const r=await fetch("/session");
        const data=await r.json();
        pc=new RTCPeerConnection();
        micStream=await navigator.mediaDevices.getUserMedia({audio:true});
        micStream.getTracks().forEach(t=>pc.addTrack(t,micStream));
        pc.ontrack=e=>remote.srcObject=e.streams[0];
        const offer=await pc.createOffer();await pc.setLocalDescription(offer);
        const sdpRes=await fetch("https://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview",
          {method:"POST",headers:{Authorization:`Bearer ${data.client_secret.value}`,"Content-Type":"application/sdp"},body:offer.sdp});
        const answer={type:"answer",sdp:await sdpRes.text()};
        await pc.setRemoteDescription(answer);
        voiceStatus.textContent="Live";
      }catch(e){voiceStatus.textContent="Unavailable";append("error","Voice unavailable.");}
    }
    pttBtn.onclick=startSession;

    /* Pause */
    const pauseBtn=document.getElementById("pauseBtn");
    pauseBtn.onclick=()=>{
      if(micStream){
        const enabled=micStream.getAudioTracks()[0].enabled;
        micStream.getAudioTracks()[0].enabled=!enabled;
        pauseBtn.textContent=enabled?"Resume":"Pause";
      }
    };

    /* Controls */
    document.getElementById("showConversation").onclick=()=>window.print();
    const contactPanel=document.getElementById("contactPanel");
    document.getElementById("contactHuman").onclick=()=>contactPanel.classList.remove("hidden");
    document.getElementById("contactClose").onclick=()=>contactPanel.classList.add("hidden");
  </script>
</body>
</html>
