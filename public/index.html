<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Walmart ‚Äì Powered by VoxTalk‚Ñ¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="navbar">
    <h1 class="brand">
      <span class="brand-main">Walmart</span>
      <span class="brand-icon">‚ú≥</span>
    </h1>
    <p class="powered-by">Powered by VoxTalk‚Ñ¢</p>
  </header>

  <main class="container">
    <div class="portal-buttons">
      <button id="cartBtn" class="portal">üõí Cart</button>
      <button id="infoBtn" class="portal">‚ÑπÔ∏è Info</button>
      <button id="checkoutBtn" class="portal">üí≥ Checkout</button>
    </div>

    <div class="chat-section">
      <h2>Talk to Your AI Walmart Grocery Associate</h2>
      <button id="pttBtn" aria-pressed="false" class="halo-button"></button>
      <div class="hint">Click to Talk</div>
      <div id="answer"><div class="muted">Conversation will appear here.</div></div>
      <audio id="remote" autoplay playsinline></audio>

      <div class="classic-chat">
        <input id="userInput" placeholder="Type here to chat‚Ä¶" />
        <button id="sendBtn">Send</button>
      </div>

      <div class="controls">
        <button id="showConversation">Show Conversation</button>
        <button id="contactHuman">Contact a Human</button>
        <button id="stopBtn">Stop</button>
      </div>
    </div>

    <div class="upload-section">
      <button id="uploadBtn">Upload Your Grocery List</button>
      <input type="file" id="fileUpload" accept=".txt,.jpg,.png,.pdf" hidden>
    </div>
  </main>

  <script>
    // --- Grocery upload button ---
    document.getElementById('uploadBtn').addEventListener('click', () => {
      document.getElementById('fileUpload').click();
    });

    // --- Classic chat handler (unchanged) ---
    const inputEl = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const answerEl = document.getElementById("answer");

    sendBtn.addEventListener("click", async () => {
      const text = inputEl.value.trim();
      if (!text) return;
      const r = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text })
      });
      const data = await r.json();
      answerEl.innerHTML += `<p>${data.reply}</p>`;
      inputEl.value = "";
    });

    // --- Realtime voice (unchanged from Clone 11) ---
    const pttBtn = document.getElementById("pttBtn");
    const remoteEl = document.getElementById("remote");

    async function startSession() {
      const r = await fetch("/session");
      const data = await r.json();
      const pc = new RTCPeerConnection();
      const ms = await navigator.mediaDevices.getUserMedia({ audio: true });
      ms.getTracks().forEach(t => pc.addTrack(t, ms));
      pc.ontrack = e => remoteEl.srcObject = e.streams[0];
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      const sdpResponse = await fetch("https://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview", {
        method: "POST",
        headers: {
          Authorization: `Bearer ${data.client_secret.value}`,
          "Content-Type": "application/sdp"
        },
        body: offer.sdp
      });
      const answer = { type: "answer", sdp: await sdpResponse.text() };
      await pc.setRemoteDescription(answer);
    }
    pttBtn.addEventListener("click", startSession);
  </script>
</body>
</html>
